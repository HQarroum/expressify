!function(e,t){if("function"==typeof define&&define.amd)define(["lodash","Joi"],t);else if("undefined"!=typeof module&&module.exports)module.exports=t(require("lodash"),require("Joi"));else{var r=this,i=t(r._,r.Joi),n=r[e];i.noConflict=function(){return r[e]=n,i},r[e]=i}}("ExpressifyResponse",function(e,t){var r={emitter:"__expressify_server",protocol:"expressify",version:"1.0.0"},i=t.object().keys({code:t.number().required(),transactionId:t.string().required(),headers:t.object().required(),payload:t.any().required(),caller:t.object().required(),type:t.string().required(),origin:t.string().optional()}).unknown().required(),n=function(e,n){this.app=e||{},this.caller=n.caller||r,this.code=n.code,this.headers=n.headers||{},this.payload=n.payload||{},this.req=n.req,this.origin=n.origin,this.type="response",this.transactionId=n.transactionId,t.validate(this,i,function(e){if(e)throw new Error(e)})};return n.fromEvent=function(e,t){return new n(e,{app:e,code:t.data.code,headers:t.data.headers,payload:t.data.payload,transactionId:t.data.transactionId,caller:t.data.caller,origin:t.origin})},n.fromRequest=function(e,t){return new n(e,{app:e,code:200,transactionId:t.data.transactionId,req:t})},n.prototype.set=function(e,t){return this.headers[e]=t,this},n.prototype.statusCode=function(e){return this.code=e,this},n.prototype.serialize=function(){return e.pick(this,e.map(i._inner.children,function(e){return e.key}))},n.prototype.send=function(t,i){this.req&&(e.isObject(t)?i=t:this.code=t,i&&(this.payload=i),this.set("Server",r.emitter+"/"+r.version),this.req.source.postMessage(this.serialize(),"*"))},n});