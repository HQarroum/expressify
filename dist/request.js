!function(e,r){if("function"==typeof define&&define.amd)define(["lodash","Joi"],r);else if("undefined"!=typeof module&&module.exports)module.exports=r(require("lodash"),require("joi"));else{var t=this,n=r(t._,t.Joi),i=t[e];n.noConflict=function(){return t[e]=i,n},t[e]=n}}("ExpressifyRequest",function(e,r){var t=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},n=function(e){return new URL(e,"http://placeholder").pathname},i=function(e){var r={},t=new URL(e,"http://placeholder"),n=!0,i=!1,o=void 0;try{for(var a,s,u=t.searchParams[Symbol.iterator]();!(n=(a=u.next()).done);n=!0)s=a.value,r[s[0]]=s[1]}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r},o=r.object().keys({resource:r.string().required(),method:r.string().required(),payload:r.any().required(),transactionId:r.string().required(),headers:r.object().required(),caller:r.object().required(),type:r.string().required(),origin:r.string().optional(),query:r.object().required()}).unknown().required(),a={emitter:"__expressify_client",protocol:"expressify",version:"1.0.0"},s=function(e,s){1===arguments.length&&(s=e),this.app=e||{},this.event=s.event||{},this.caller=s.caller||a,this.resource=n(s.resource),this.method=s.method,this.payload=s.payload||{},this.headers=s.headers||{},this.origin=s.origin,this.transactionId=s.transactionId||t(),this.query=s.query||i(s.resource),this.type="request",this.set("User-Agent",a.emitter+"/"+a.version),r.validate(this,o,function(e){if(e)throw new Error(e)})};return s.from=function(e,r){return new s(e,{event:r,method:r.data.method,resource:r.data.resource,headers:r.data.headers,payload:r.data.payload,caller:r.data.caller,transactionId:r.data.transactionId,origin:r.origin,query:r.data.query})},s.prototype.set=function(e,r){return this.headers[e]=r,this},s.prototype.get=function(e){return this.headers[e]},s.prototype.serialize=function(){return e.pick(this,e.map(o._inner.children,function(e){return e.key}))},s});