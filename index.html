<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
  <script src="bower_components/middleware-chain/dist/middleware-chain.min.js"></script>
  <script src="bower_components/eventemitter2/lib/eventemitter2.js"></script>
  <script src="dist/query-protocol.min.js"></script>
</head>
<body>

<h2>JavaScript din Body</h2>

<p id="demo">A Paragraph.</p>

<button type="button" onclick="myFunction()">Try it</button>

<script>
const app = new QueryProtocol.Server();
const client = new QueryProtocol.Client();

/*const request = new QueryProtocol.Client({
  connection: window,
  url: 'https://foo.com'
});*/

app.use((req, res, next) => {
  console.log(req);
 if (req.origin !== 'null') {
  return next(new Error('Domain forbidden'));
 }
 next();
});

/**
 * Handling a request for the `/post` resource.
 */
app.get('/foo/:toto', (req, res) => {
  console.log('called post with', req.params, 'and path', req.path);
 res.send(200, {
  postId: req.params.id,
  name: 'my-post'
 });
});

/**
 * Handling a request for the `/user` resource.
 */
app.get('/user/:id/address/:type', (req, res) => {
  console.log('called user with', req.params);
 res.send(200, {
  firstName: 'Halim',
  lastName: 'Qarroum'
 });
});

app.use((err, req, res, next) => {
  console.log('Catched error', err);
});

app.listen();

window.addEventListener('message', function (event) {
  //console.log('Callback called with', event);
});

setTimeout(function () {
  client.get('/foo/1').then((res) => {
    console.log('Response', res);
  }, (err) => {
    console.log('Error', err);
  })
}, 2000);


/*window.postMessage({
  caller: {},
  payload: { foo: 'bar' },
  resource: '/foo/toto',
  method: 'get',
  transactionId: 2
}, '*');

window.postMessage({
  caller: {},
  payload: { foo: 'bar' },
  resource: '/user/1/address/foo',
  method: 'get',
  transactionId: 2
}, '*');*/

</script>

</body>
</html>
